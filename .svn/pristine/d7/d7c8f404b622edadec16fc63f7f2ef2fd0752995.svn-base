<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.tscloud.address.server.mapper.DistrictMapper">
    <!--街道数据-->
    <sql id="districtColumns">
      a.district_id     as addrId,
      a.name            as name,
      a.x_coordinate    as x,
      a.y_coordinate    as y,
      'district'        as dataType
    </sql>
    <select id="getDistrict" resultType="DistrictEntity" parameterType="java.util.Map">
        SELECT <include refid="districtColumns"/> FROM gdb_district a
        <where>

        </where>
    </select>


    <!--社区居委会-->
    <sql id="villageColumns">
        a.village_id     as addrId,
        a.name           as name,
        a.x_coordinate   as x,
        a.y_coordinate   as y,
        'village'       as dataType
    </sql>
    <select id="getVillage" resultType="DistrictEntity" parameterType="java.util.Map">
        SELECT <include refid="villageColumns"/> FROM gdb_village a
        <where>
            <if test="addrId!=null">
             a.district_id=#{addrId}
            </if>
        </where>
    </select>

    <!--道路数据-->
    <sql id="roadColumns">
            p.id       as addrId,
            p.address  as name ,
            p.x        as x,
            p.y        as y,

    </sql>
    <select id="getRoad" resultType="DistrictEntity" parameterType="java.util.Map">
        SELECT <include refid="roadColumns"/>  'road' as dataType FROM (
          SELECT p.road_id AS id,p.village_id, p.adcode, p.poi_type, p.x_coordinate AS x, p.y_coordinate AS y, p.name, p.full_name AS fullname, ((p.name)::text) AS address FROM gdb_road p
          UNION ALL
          SELECT p.road_branch_id AS id,p.village_id,p.adcode, p.poi_type, p.x_coordinate AS x, p.y_coordinate AS y, p.name, p.full_name AS fullname,
                ((( CASE WHEN (p.road_id IS NULL) THEN ''::character varying ELSE ( SELECT g.name FROM gdb_road g WHERE ((p.road_id IS NOT NULL) AND (g.road_id = p.road_id))) END)::text) || (p.name)::text) AS address FROM gdb_road_branch p ) p
        <where>
            <if test="addrId!=null">
                p.village_id=#{addrId}
            </if>
        </where>
    </select>
    <select id="getStreetno" resultType="DistrictEntity" parameterType="java.util.Map">
      SELECT <include refid="roadColumns"/> 'streetno' as dataType FROM(
        SELECT streetno_sub_id AS id,p.road_id,p.road_branch_id, p.adcode, p.poi_type, p.x_coordinate AS x, p.y_coordinate AS y, p.name, p.full_name AS fullname, (((CASE WHEN (p.streetno_id IS NULL) THEN ''::character varying ELSE ( SELECT i.name FROM gdb_streetno i WHERE ((p.streetno_id IS NOT NULL) AND (i.streetno_id = p.streetno_id))) END)::text) || (p.name)::text) AS address FROM gdb_streetno_sub p
         UNION ALL
        SELECT p.streetno_id AS id,p.road_id,p.road_branch_id, p.adcode, p.poi_type, p.x_coordinate AS x, p.y_coordinate AS y, p.name, p.full_name AS fullname, ( (p.name)::text) AS address FROM gdb_streetno p)p
        <where>
            <if  test="addrId!=null">
                p.road_id=#{addrId} or p.road_branch_id=#{addrId}
            </if>
        </where>
    </select>


    <!--小区数据 根据社区居委会查询-->
    <sql id="communityColumns">
        a.community_id  as addrId,
        a.name          as name,
        a.x_coordinate  as x,
        a.y_coordinate  as y,
        'community'     as dataType
    </sql>
    <select id="getCommunity" resultType="DistrictEntity" parameterType="java.util.Map">
        SELECT <include refid="communityColumns"/> FROM gdb_community a
        <where>
            <if test="addrId!=null">
                a.village_id=#{addrId}
            </if>
        </where>
    </select>

    <!--标记物 TODO 预留-->
    <sql id="landmarkColumns">
        a.landmark_id   as addrId,
        a.name          as name,
        a.x_coordinate  as x,
        a.y_coordinate  as y,
        'landmark'      as dataType
    </sql>
    <select id="getLandmark" resultType="DistrictEntity" parameterType="java.util.Map">
      SELECT  <include refid="landmarkColumns"/> FROM  gdb_landmark a
        <where>
            <if test="addrId!=null">
                a.road_id=#{addrId} or a.road_branch_id=#{addrId} or a.streetno_id=#{addrId} or a.streetno_sub_id=#{addrId}
            </if>
        </where>
    </select>
    
    <!--获取楼栋数据-->
    <sql id="buildingColumns1">

    </sql>
    <select id="cc">

    </select>

    <!--楼栋查询-->
    <sql id="buildingColumns">
       a.building_id  as addrId,
       a.name         as name,
       a.x_coordinate as x,
       a.y_coordinate as y,
       'buildings'    as dataType
    </sql>
    <select id="getBuilding">
      SELECT <include refid="buildingColumns"/> FROM gdb_buildings a
    </select>
    <!--门牌号+楼层+房号查询-->
    <sql id="unitColumns">
      a.buildingsunit_id  as addrId,
      a.name              as name,
      a.x_coordinate      as x,
      a.y_coordinate      as y,
      'unit'              as dataType
    </sql>
    <sql id="floorColumns">
        b.buildingsfloor_id   as addrId,
        b.name                as name,
        b.x_coordinate        as x,
        b.y_coordinate        as y,
        'floor'               as dataType
    </sql>
    <sql id="roomColumns">
        c.buildingsfloor_id    as addrId,
        c.name                 as name,
        c.x_coordinate         as x,
        c.y_coordinate         as y,
        'room'                 as dataType
    </sql>
    <select id="getRoomUnit"  resultType="DistrictEntity" parameterType="java.util.Map">
      SELECT <include refid="unitColumns"/> FROM gdb_buildingsunit a
        UNION ALL
      SELECT <include refid="floorColumns"/> FROM gdb_buildingsfloor b
        UNION ALL
      SELECT <include refid="roomColumns"/> FROM gdb_buildingsroom c
    </select>
</mapper>