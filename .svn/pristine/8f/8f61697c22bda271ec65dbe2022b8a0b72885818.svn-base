<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.tscloud.address.server.mapper.DistrictMapper">
   <!-- <resultMap id="baseResultMap" type="DistrictEntity">
        <id column="district_id" jdbcType="INTEGER" property="districtId"/>
        <result column="city_id" jdbcType="INTEGER" property="cityId"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="county_id" jdbcType="INTEGER" property="countyId"/>
        <result column="x_coordinate" jdbcType="DOUBLE" property="x"/>
        <result column="y_coordinate" jdbcType="DOUBLE" property="y"/>
    </resultMap>-->

    <!--街道数据-->
    <sql id="districtColumns">
      a.district_id     as addrId,
      a.name            as name,
      a.x_coordinate    as x,
      a.y_coordinate    as y,
      'district'        as dataType
    </sql>
    <select id="getDistrict" resultType="DistrictEntity" parameterType="java.util.Map">
        SELECT <include refid="districtColumns"/> FROM gdb_district a
        <where>

        </where>
    </select>

    <!--街道下路相关数据 gdb_road:主路，gdb_road_branch:支路-->
    <sql id="roadColumns">
        a.road_id       as addrId,
        a.name          as name ,
        a.x_coordinate  as x,
        a.y_coordinate  as y ,
        'road'          as dataType
    </sql>
    <sql id="roadBranchColumns">
      b.road_branch_id  as addrId,
      b.name            as name,
      b.x_coordinate    as x,
      b.y_coordinate    as y,
      'roadBranch'      as dataType
    </sql>
    <select id="getRoad" resultType="DistrictEntity" parameterType="java.util.Map">
        SELECT <include refid="roadColumns"/> FROM gdb_road a
        <where>
          <if test="dataType!=null || dataType=='road'">
            <if test="addrId!=null">
                a.district_id=#{addrId}
            </if>
          </if>
        </where>
        UNION ALL
        SELECT <include refid="roadBranchColumns"/> FROM gdb_road_branch b
        <where>
            <if test="dataType!=null || dataType=='roadBranch'">
                <if test="addrId!=null">
                    b.district_id=#{addrId}
                </if>
            </if>
        </where>
    </select>

    <!--查询路号-->
    <sql id="streetnoColumns">
        a.streetno_id   as addrId,
        a.name          as name,
        a.x_coordinate  as x,
        a.y_coordinate  as y,
        'streetno'      as dataType
    </sql>
    <sql id="streetnoSubColumns">
      b.streetno_id     as addrId,
      b.name            as name ,
      b.x_coordinate    as x,
      b.y_coordinate    as y ,
      'streetnoSub'     as dataType
    </sql>
    <select id="getStreetno" resultType="DistrictEntity" parameterType="java.util.Map">
      SELECT <include refid="streetnoColumns"/> FROM gdb_streetno a
        <where>
            <if test="dataType!=null || dataType=='road'">
                <if test="addrId!=null">
                    a.road_id=#{addrId}
                </if>
            </if>
        </where>
        UNION ALL
      SELECT <include refid="streetnoSubColumns"/> FROM gdb_streetno_sub b
        <where>
            <if test="dataType!=null || dataType=='road'">
                <if test="addrId!=null">
                    a.road_branch_id=#{addrId}
                </if>
            </if>
        </where>
    </select>

    <!--查询村社区 根据相应的路号 主路号和分路号id-->
    <sql id="communityColumns">
        a.community_id  as addrId,
        a.name          as name,
        a.x_coordinate  as x,
        a.y_coordinate  as y,
        'community'     as dataType
    </sql>
    <select id="getCommunity" resultType="DistrictEntity" parameterType="java.util.Map">
      SELECT <include refid="communityColumns"/> FROM gdb_community a
        <where>
            <if test="addrId!=null">
                a.road_branch_id=#{addrId}
            </if>
        </where>
    </select>
    <!--楼栋查询-->
    <sql id="buildingColumns">
       a.building_id  as addrId,
       a.name         as name,
       a.x_coordinate as x,
       a.y_coordinate as y,
       'buildings'    as dataType
    </sql>
    <select id="getBuilding">
      SELECT <include refid="buildingColumns"/> FROM gdb_buildings a
    </select>
    <!--门牌号+楼层+房号查询-->
    <sql id="unitColumns">
      a.buildingsunit_id  as addrId,
      a.name              as name,
      a.x_coordinate      as x,
      a.y_coordinate      as y,
      'unit'              as dataType
    </sql>
    <sql id="floorColumns">
        b.buildingsfloor_id   as addrId,
        b.name                as name,
        b.x_coordinate        as x,
        b.y_coordinate        as y,
        'floor'               as dataType
    </sql>
    <sql id="roomColumns">
        c.buildingsfloor_id    as addrId,
        c.name                 as name,
        c.x_coordinate         as x,
        c.y_coordinate         as y,
        'room'                 as dataType
    </sql>
    <select id="getRoomUnit"  resultType="DistrictEntity" parameterType="java.util.Map">
      SELECT <include refid="unitColumns"/> FROM gdb_buildingsunit a
        UNION ALL
      SELECT <include refid="floorColumns"/> FROM gdb_buildingsfloor b
        UNION ALL
      SELECT <include refid="roomColumns"/> FROM gdb_buildingsroom c
    </select>
</mapper>